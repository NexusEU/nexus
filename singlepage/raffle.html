<html>
    <head>
        <title>Raffle</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <meta charset="UTF-8">
        <script>
            $(function() {
                $('#contestants-template').hide();
                addContestant();
                $('#add').click(addContestant);
                $('#draw').click(function(){
                    var tickets = [];
                    var winners = [];
                    var drawsRemaining = parseInt($('#numberofwinners').val());
                    if(!drawsRemaining) drawsRemaining=1;
                    var allowDupes = $('#duplicate').is(":checked");

                    debugger;

                    $('#contestants .row').each(function(index){
                        var name = $(this).find('.name').val();
                        
                        if(name.length>0){
                            var newtickets = parseInt($(this).find('.tickets').val());

                            if(!newtickets) newtickets=0;
                            
                            var tmp = Array.apply(null, Array(newtickets)).map(function () {return name;})
                            tickets.push(...tmp);
                        }
                    })

                    while(drawsRemaining>0 && tickets.length>0){
                        var winner = tickets[Math.floor(Math.random()*tickets.length)];
                        winners.push(winner);
                        if(!allowDupes) {
                            tickets = tickets.filter(a => a !== winner)
                        }
                        drawsRemaining--;
                    }

                    $('#result').empty();
                    for(var i = 0; i < winners.length; i++) {
                        $('#result').append( $('<p>').text('#'+(i+1).toString()+": "+winners[i]));
                    }
                    
                })
            });

            function deleteContestant(e) {
                $(e).parent('.row').remove();
            }

            function addContestant() {
                $('#contestants').append($('#contestants-template').clone().show().removeAttr('id'));
            }
        </script>
    </head>
    <body>
        <h1>Raffle</h1>
        <p>Number of winners: <input type="number" id="numberofwinners" name="quantity" min="1" max="5"></p>
        <p>Allow duplicate winners: <input type="checkbox" id="duplicate" name="duplicate"></p>
        <p>Enter contestants</p>
        <div id="contestants">

        </div>
        
        <p>
            <div id="contestants-template" class="row">
                Name: <input type="text" class="name"> 
                Tickets: <input type="number" class="tickets" min="1" max="10000">
                <button onclick="deleteContestant(this)">Remove</button>
            </div>
        </p>

        <p>
            <button id="add">Add contestant</button>
            <button id="draw">Draw</button>
        </p>

        <p id="result"></p>
    </body>
</html>